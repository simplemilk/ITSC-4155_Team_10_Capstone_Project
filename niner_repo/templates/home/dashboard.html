{% extends 'base.html' %}

{% block title %}Financial Dashboard - Niner Finance{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

<div class="dashboard-container">
  <!-- Financial Overview Section -->
  <section class="dashboard-section overview-section">
    <div class="section-header">
      <h2><i class="fas fa-chart-line me-2"></i>Financial Overview</h2>
      <button class="btn btn-outline-primary btn-sm" onclick="refreshDashboard()">
        <i class="fas fa-sync-alt me-1"></i>Refresh
      </button>
    </div>
    <div class="overview-grid" id="financial-overview">
      <div class="overview-card total-income">
        <div class="card-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="card-content">
          <h3>Total Income</h3>
          <p class="amount text-success">$<span id="total-income">0.00</span></p>
          <p class="period">This Month</p>
        </div>
      </div>
      <div class="overview-card total-expenses">
        <div class="card-icon">
          <i class="fas fa-credit-card"></i>
        </div>
        <div class="card-content">
          <h3>Total Expenses</h3>
          <p class="amount text-danger">$<span id="total-expenses">0.00</span></p>
          <p class="period">This Month</p>
        </div>
      </div>
      <div class="overview-card total-savings">
        <div class="card-icon">
          <i class="fas fa-piggy-bank"></i>
        </div>
        <div class="card-content">
          <h3>Net Savings</h3>
          <p class="amount text-info">$<span id="total-savings">0.00</span></p>
          <p class="savings-rate">Rate: <span id="savings-rate">0</span>%</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Income Breakdown Section -->
  <section class="dashboard-section income-section">
    <div class="section-header">
      <h2><i class="fas fa-chart-pie me-2"></i>Income Sources</h2>
      <a href="{{ url_for('income.index') }}" class="btn btn-outline-success btn-sm">
        <i class="fas fa-plus me-1"></i>Add Income
      </a>
    </div>
    <div class="income-chart-container">
      <canvas id="income-chart"></canvas>
    </div>
    <div class="income-list" id="income-breakdown">
      <div class="loading">
        <i class="fas fa-spinner fa-spin me-2"></i>Loading income data...
      </div>
    </div>
  </section>

  <!-- Budget Status Section -->
  <section class="dashboard-section budget-section">
    <div class="section-header">
      <h2><i class="fas fa-chart-bar me-2"></i>Budget Status</h2>
      <a href="{{ url_for('budget.index') }}" class="btn btn-outline-primary btn-sm">
        <i class="fas fa-cog me-1"></i>Manage Budget
      </a>
    </div>
    <div class="budget-grid" id="budget-status">
      <div class="loading">
        <i class="fas fa-spinner fa-spin me-2"></i>Loading budget data...
      </div>
    </div>
  </section>

  <!-- Recent Activity Section -->
  <section class="dashboard-section activity-section">
    <div class="section-header">
      <h2><i class="fas fa-history me-2"></i>Recent Activity</h2>
      <a href="{{ url_for('transactions.index') }}" class="btn btn-outline-info btn-sm">
        <i class="fas fa-list me-1"></i>View All
      </a>
    </div>
    <div class="activity-list" id="recent-activity">
      <div class="loading">
        <i class="fas fa-spinner fa-spin me-2"></i>Loading recent activity...
      </div>
    </div>
  </section>

  <!-- Quick Actions Section -->
  <section class="dashboard-section quick-actions-section">
    <div class="section-header">
      <h2><i class="fas fa-bolt me-2"></i>Quick Actions</h2>
    </div>
    <div class="quick-actions-grid">
      <button class="quick-action-btn" onclick="showAddIncomeModal()">
        <i class="fas fa-plus-circle"></i>
        <span>Add Income</span>
      </button>
      <button class="quick-action-btn" onclick="showAddExpenseModal()">
        <i class="fas fa-minus-circle"></i>
        <span>Add Expense</span>
      </button>
      <button class="quick-action-btn" onclick="viewBudget()">
        <i class="fas fa-chart-pie"></i>
        <span>View Budget</span>
      </button>
      <button class="quick-action-btn" onclick="generateReport()">
        <i class="fas fa-file-download"></i>
        <span>Export Report</span>
      </button>
    </div>
  </section>

  <!-- Financial Goals Section -->
  <section class="dashboard-section goals-section">
    <div class="section-header">
      <h2><i class="fas fa-target me-2"></i>Financial Goals</h2>
      <button class="btn btn-outline-warning btn-sm" onclick="addGoal()">
        <i class="fas fa-plus me-1"></i>Add Goal
      </button>
    </div>
    <div class="goals-grid" id="financial-goals">
      <div class="goal-card">
        <h4>Emergency Fund</h4>
        <div class="goal-progress">
          <div class="progress mb-2">
            <div class="progress-bar bg-success" style="width: 45%"></div>
          </div>
          <div class="goal-details">
            <span class="current">$450</span>
            <span class="target">/ $1,000</span>
          </div>
        </div>
      </div>
      <div class="goal-card">
        <h4>Textbook Fund</h4>
        <div class="goal-progress">
          <div class="progress mb-2">
            <div class="progress-bar bg-info" style="width: 70%"></div>
          </div>
          <div class="goal-details">
            <span class="current">$350</span>
            <span class="target">/ $500</span>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Templates for dynamic content -->
<template id="income-item-template">
  <div class="income-item">
    <div class="income-category">
      <span class="category-name"></span>
      <span class="entry-count"></span>
    </div>
    <div class="income-amounts">
      <div class="total-amount">$<span class="amount"></span></div>
      <div class="average-amount">avg: $<span class="average"></span></div>
    </div>
  </div>
</template>

<template id="budget-item-template">
  <div class="budget-item">
    <div class="budget-category">
      <i class="category-icon"></i>
      <span class="category-name"></span>
    </div>
    <div class="budget-progress">
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      <div class="budget-amounts">
        <span class="spent-amount"></span> / <span class="allocated-amount"></span>
      </div>
      <div class="budget-status"></div>
    </div>
  </div>
</template>

<template id="activity-item-template">
  <div class="activity-item">
    <div class="activity-icon"></div>
    <div class="activity-details">
      <div class="activity-title"></div>
      <div class="activity-meta">
        <span class="activity-amount"></span>
        <span class="activity-date"></span>
      </div>
    </div>
  </div>
</template>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}