{% extends "base.html" %}

{% block title %}Deleted Transactions - Niner Finance{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/transaction.css') }}">

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            <i class="fas fa-trash-restore me-2"></i>
            Deleted Transactions
        </h2>
        <div>
            <a href="{{ url_for('transactions.index') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Transactions
            </a>
            {% if deleted_transactions %}
            <button class="btn btn-danger" onclick="confirmPermanentDeleteAll()">
                <i class="fas fa-trash-alt me-2"></i>Permanently Delete All
            </button>
            {% endif %}
        </div>
    </div>

    {% if deleted_transactions %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        These transactions have been deleted but can be restored. They will be permanently removed after 30 days.
    </div>

    <div class="recent-transactions">
        {% for transaction in deleted_transactions %}
        <div class="transaction-item deleted-item" data-id="{{ transaction.id }}">
            <div class="transaction-icon" style="background-color: #95a5a6; opacity: 0.6;">
                <i class="{{ 
                    'fas fa-utensils' if transaction.category == 'food' else
                    'fas fa-car' if transaction.category == 'transportation' else
                    'fas fa-film' if transaction.category == 'entertainment' else
                    'fas fa-ellipsis-h' if transaction.category == 'other' else
                    'fas fa-plus'
                }}"></i>
            </div>
            <div class="transaction-details">
                <div class="transaction-description">
                    {{ transaction.description }}
                    <span class="badge bg-secondary ms-2">Deleted</span>
                </div>
                <div class="transaction-meta">
                    <i class="fas fa-calendar-alt"></i>
                    {{ transaction.date }} • 
                    {{ transaction.category.title() if transaction.category else 'Uncategorized' }} •
                    <span class="text-muted">Deleted {{ transaction.deleted_at|default('recently') }}</span>
                </div>
            </div>
            <div class="transaction-amount text-muted">
                {{ '-' if transaction.type == 'expense' else '+' }}${{ transaction.amount|round(2) }}
            </div>
            <div class="transaction-actions">
                <form method="POST" action="{{ url_for('transactions.restore', id=transaction.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-sm btn-success" title="Restore transaction">
                        <i class="fas fa-undo me-1"></i>Restore
                    </button>
                </form>
                <button class="btn btn-sm btn-danger ms-2" 
                        onclick="confirmPermanentDelete({{ transaction.id }}, '{{ transaction.description }}')"
                        title="Permanently delete">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">
            <i class="fas fa-trash"></i>
        </div>
        <h5>No Deleted Transactions</h5>
        <p>You haven't deleted any transactions yet.</p>
        <a href="{{ url_for('transactions.index') }}" class="btn btn-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Transactions
        </a>
    </div>
    {% endif %}
</div>

<!-- Permanent Delete Confirmation Modal -->
<div class="modal fade" id="permanentDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Permanent Delete Warning
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-danger fw-bold">⚠️ This action cannot be undone!</p>
                <p>Are you sure you want to permanently delete this transaction?</p>
                <p class="fw-bold" id="permanentDeleteName"></p>
                <p class="text-muted small">This will remove the transaction from the database completely.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="permanentDeleteForm" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt me-2"></i>Permanently Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function confirmPermanentDelete(id, description) {
    const modal = new bootstrap.Modal(document.getElementById('permanentDeleteModal'));
    document.getElementById('permanentDeleteName').textContent = description;
    document.getElementById('permanentDeleteForm').action = `/transactions/${id}/permanent-delete`;
    modal.show();
}

function confirmPermanentDeleteAll() {
    if (confirm('⚠️ WARNING: This will permanently delete ALL deleted transactions. This action cannot be undone!\n\nAre you sure you want to continue?')) {
        window.location.href = '{{ url_for("transactions.permanent_delete_all") }}';
    }
}
</script>
{% endblock %}